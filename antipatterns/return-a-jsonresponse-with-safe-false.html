<!doctype html>
<htm lang="en">
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Security-Policy" content="frame-src https://www.buymeacoffee.com; style-src 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.rawgit.com https://vjs.zencdn.net 'self'; script-src 'sha256-nP0EI9B9ad8IoFUti2q7EQBabcE5MS5v0nkvRfUbYnM=' https://cdnjs.buymeacoffee.com https://code.jquery.com https://cdnjs.cloudflare.com https://cdn.rawgit.com https://vjs.zencdn.net https://pagead2.googlesyndication.com 'self'">
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta name="keywords" content="Django, web, programming, antipattern, pattern, troubleshooting, software design, django-models, django-views, django-templates, django-orm">
    <meta name="author" content="Willem Van Onsem">
    <meta name="description" content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django.">
    <meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f" />
    <meta name="og:title" content="Return a JsonResponse with safe=False" />
    <meta name="og:image" content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f" />
    <meta name="og:image:alt" content="A prohibition sign in the Django color scheme." />
    <meta name="og:image:type" content="image/png" />
    <meta name="og:type" content="website" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="/style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script-->
  
    <!--script src="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/script.js"></script-->
  
    <script src="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js"></script>
    <script data-ad-client="ca-pub-9962024266760159" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Django antipatterns &#x3009;antipattern &#x3009;Return a JsonResponse with safe=False</title>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
  </style>
</head>
<body>
  <a class="github-fork-ribbon" href="https://github.com/hapytex/django-antipatterns" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">Return a <code>JsonResponse</code> with <code>safe=False</code></span>
        <ul class="nav pull-right doc-info">
                                        <li>
            <div class="rating" data-rating="3">
              severity:
              <i class="star-1">★</i>
              <i class="star-2">★</i>
              <i class="star-3">★</i>
              <i class="star-4">★</i>
              <i class="star-5">★</i>
            </div>
          </li>
                  </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div class="span12">
            <p>Often people find out that you can not return a <em>list</em> as outer item in a <a href="https://docs.djangoproject.com/en/3.1/ref/request-response/#jsonresponse-objects"><strong><code>JsonResponse</code></strong> [Django-doc]</a> and decide to use <code>safe=False</code> to still allow this. This thus looks like:</p>
<pre class="python"><code>from django.http import JsonResponse

# &hellip;
return JsonResponse([1,4,2,5]<b>, safe=False</b>)</code></pre>
<h1 id="why-is-it-a-problem">Why is it a problem?</h1>
<p>As the parameter already indicates, it is unsafe. <em>Phil Haack</em> published a <a href="https://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx/">blog post in 2008</a> where he manages to exploit the contain of an array by overriding the <code>Array</code> function in JavaScript.</p>
<p>Most browsers have fixed this exploit, but nevertheless, you never can be sure that the browser of the client has been protected against this exploit. Therefore it might be better to still return safe responses.</p>
<h1 id="what-can-be-done-to-resolve-the-problem">What can be done to resolve the problem?</h1>
<p>You can wrap the data in an extra dictionary. For example a dictionary where you have a key <code>&quot;data&quot;</code> that then maps to the list:</p>
<pre class="python"><code>from django.http import JsonResponse

# &hellip;
return JsonResponse(<b>{'data':</b> [1,4,2,5]<b>}</b>)</code></pre>
<h1 id="extra-tips">Extra tips</h1>
<p>Companies like <em>Google</em> and <em>Facebook</em> add extra protection. These companies return a JSON response with extra measures for example <em>Google</em> returns:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="er">throw</span> <span class="er">1;</span> <span class="er">&lt;dont</span> <span class="er">be</span> <span class="er">evil&gt;</span> <span class="fu">{</span><span class="dt">&quot;foo&quot;</span><span class="fu">:</span> <span class="st">&quot;bar&quot;</span><span class="fu">}</span></code></pre></div>
<p>and <em>Facebook</em> returns:</p>
<pre><code>for(;;); {&quot;foo&quot;: &quot;bar&quot;}</code></pre>
<p>These will prevent &quot;running&quot; the JSON file, since it will either throw an exception, or get stuck in an infinite loop. At the moment Django's <code>JsonResponse</code> does not perform such formatting, but it is easy to implement such response manually.</p>
      <script nonce data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="hapytex" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
