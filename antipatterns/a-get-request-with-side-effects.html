<!doctype html>
<htm lang="en">
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta http-equiv="Content-Security-Policy" content="frame-src https://www.buymeacoffee.com; style-src 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.rawgit.com 'self'; script-src 'sha256-nP0EI9B9ad8IoFUti2q7EQBabcE5MS5v0nkvRfUbYnM=' https://cdnjs.buymeacoffee.com https://code.jquery.com https://cdnjs.cloudflare.com https://cdn.rawgit.com https://pagead2.googlesyndication.com 'self'">
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta name="keywords" content="Django, web, programming, antipattern, pattern, troubleshooting, software design, django-models, django-views, django-templates, django-orm">
    <meta name="author" content="Willem Van Onsem">
    <meta name="description" content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django.">
    <meta name="twitter:image:src" content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f" />
    <meta name="og:title" content="A GET request with side-effects" />
    <meta name="og:image" content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f" />
    <meta name="og:image:alt" content="A prohibition sign in the Django color scheme." />
    <meta name="og:image:type" content="image/png" />
    <meta name="og:type" content="website" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    <!-- <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" /> -->

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="/style.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script-->
  
    <!--script src="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/script.js"></script-->
  
    <script src="https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js"></script>
    <script data-ad-client="ca-pub-9962024266760159" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="generator" content="pandoc" />
  <title>Django antipatterns &#x3009;antipattern &#x3009;A GET request with side-effects</title>
</head>
<body>
  <a class="github-fork-ribbon" href="https://github.com/hapytex/django-antipatterns" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">A GET request with side-effects</span>
        <ul class="nav pull-right doc-info">
                                        <li>
            <div class="rating" data-rating="4">
              severity:
              <i class="star-1">★</i>
              <i class="star-2">★</i>
              <i class="star-3">★</i>
              <i class="star-4">★</i>
              <i class="star-5">★</i>
            </div>
          </li>
                  </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div class="span12">
            <p>Often people construct views that have side, effects, for example:</p>
<pre class="python"><code>def remove_comment(request, comment_pk):
    Comment.objects.<b>filter(</b>
        comment_id=comment_pk
    )<b>.delete()</b>
    # &hellip;</code></pre>
<h1 id="why-is-it-a-problem">Why is it a problem?</h1>
<p>Because this violates the HTTP standard. In the section <a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.1.1"><em>safe methods</em> of the HTTP specifications [w3.org]</a> it specifies that:</p>
<blockquote>
<p>In particular, the convention has been established <strong>that the GET</strong> and HEAD methods <strong>SHOULD NOT have the significance</strong> of taking an action <strong>other than retrieval</strong>. These methods <strong>ought to be considered &quot;safe&quot;</strong>.</p>
</blockquote>
<p>A GET request should thus not create, update, or delete entities.</p>
<p>This is important because other actors on the internet assume that a GET request is safe. For example if a browser will not give a warning if you refresh the browser with an additional GET request, whereas most browsers will do that for a POST request.</p>
<p>Search engines have web crawlers that look for URLs on pages, and will make GET requests to these pages to analyze the page that is returned and look for more URLs. This thus means that a GET request of such crawler might accidentally create, remove and update entities.</p>
<p>Django also does not offer security mechanisms like a CSRF-token for GET requests. This thus makes <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery (CSRF) [wiki]</a> easier.</p>
<h1 id="what-can-be-done-to-resolve-the-problem">What can be done to resolve the problem?</h1>
<p>One should use POST, PUT, PATCH, or DELETE requests to update entities. These are the HTTP methods designed for this. One can use for example the <a href="https://docs.djangoproject.com/en/3.1/topics/http/decorators/#django.views.decorators.http.require_http_methods"><strong><code>@require_http_methods</code></strong> decorator [Django-doc]</a> to restrict a view to certain HTTP methods. This will return a <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes#4xx_client_errors">HTTP 405 &quot;<em>Method Not Allowed</em>&quot; response [wiki]</a> to warn the client that this request was not allowed:</p>
<pre class="python"><code>from django.views.decorators.http import <b>require_http_methods</b>

<b>@require_http_methods(['POST'])</b>
def remove_comment(request, comment_pk):
    Comment.objects.<b>filter(</b>
        comment_id=comment_pk
    <b>).delete()</b>
    # &hellip;</code></pre>
<p>The HTML page should thus use a mini <code>&lt;form&gt;</code> to produce the POST request, or an AJAX call.</p>
      <script nonce data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="hapytex" data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
